#!/bin/sh

# Let's start with some settings
BOILERPLATE_DIRECTORY="${HOME}/Sites/projects"
BOILERPLATE_TARBALL_PATH="https://github.com/vitorbritto/boilerplates/tarball/master/general"
LIBS_DIRECTORY="${HOME}/.forcefiles/lib"
source ${LIBS_DIRECTORY}/utils

# If directory is missing...
if [[ ! -d ${BOILERPLATE_DIRECTORY} ]]; then
    mkdir ${BOILERPLATE_DIRECTORY}
fi

# Download and extract the boilerplate repository
init_download() {

    printf "$(tput setaf 7)Downloading repository...\033[m\n"
    # Get the tarball
    curl -fsSLo ${HOME}/boilerplate.tar.gz ${BOILERPLATE_TARBALL_PATH}
    # Extract to the boilerplate directory
    tar -zxf ${HOME}/boilerplate.tar.gz --strip-components 1 -C ${BOILERPLATE_DIRECTORY}
    # Remove the tarball
    rm -rf ${HOME}/boilerplate.tar.gz

}

# Setup the project
init_config() {

    cd ${BOILERPLATE_DIRECTORY}
    printf "\n"
    printf "Please enter a name for this project:"
    printf "\n"
    read -p "Enter your name here: " app
    mkdir $app && cd $app

}

# NPM Dependencies
init_npm() {

    e_header "Setting up dependencies from NPM..."
    cd src
    npm install
    e_success "Done!"

}

# And finally, start Grunt
init_grunt() {

    seek_confirmation "Do you want to run Grunt now?"

    if is_confirmed; then
        grunt
    fi

    e_success "Done!"
}

# Open Sublime
init_editor() {

    seek_confirmation "Do you want to open files in your editor?"

    if is_confirmed; then
        e_header "Opening your editor..."
        cd .. && subl .
    fi

    e_success "Done!"
}

# Let's rock!
printf "Please, wait... "
init_download
init_config
init_npm
init_grunt
init_editor
