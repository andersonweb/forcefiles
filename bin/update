#!/bin/bash

# up to you (me) if you want to run this as a file or copy paste at your leisure

# Improve workflow script
# Stand-alone: run with alias "up"

# Ask for the administrator password upfront
sudo -v

# Clear console
clear

# Let's start with some settings
FORCEFILES_DIRECTORY="${HOME}/.forcefiles"

cd ${FORCEFILES_DIRECTORY}

source ./lib/utils
source ./lib/rubies
source ./lib/php
source ./lib/gems
source ./lib/apps

# Check for Homebrew
if ! type_exists 'brew'; then
    e_header "Installing Homebrew..."
    ruby -e "$(curl -fsSkL raw.github.com/mxcl/homebrew/go)"
fi

# Check for rvm
if ! type_exists 'rvm'; then
    e_header "Installing Rvm..."
    curl -L https://get.rvm.io | bash -s stable
fi

# Install Rubies
seek_confirmation "Do you want to install Rubies (~1.9.3 and ~2.0.0)?"

if is_confirmed; then
    run_rubies
    e_success "Done!"
else
    e_warning "Skipped!"
fi

# Install RubyGems
seek_confirmation "Would you like to install RubyGems now?"

if is_confirmed; then
    run_gems
    e_success "Done!"
else
    e_warning "Skipped!"
fi

# Install PHP 5.4, MySQL and phpMyAdmin
seek_confirmation "Would you like to install PHP 5.4, MySQL and phpMyAdmin now?"

if is_confirmed; then
    run_php
    e_success "Done!"
else
    e_warning "Skipped!"
fi

# Install my Applications
seek_confirmation "Would you like to install applications now?"

if is_confirmed; then
    e_header "Seat back a while... this may take several minutes to install."
    run_apps
    e_success "Done!"
else
    e_warning "Skipped!"
fi

# Install Vagrant, VirtualBox and VMS
seek_confirmation "Would you like to install your Vagrant Development environments now?"

if is_confirmed; then

    # Check for Vagrant
    if ! type_exists 'vagrant'; then
        e_error "You need to install Vagrant and VirtualBox."

        # Install my Applications
        seek_confirmation "Would you like to install now?"

        if is_confirmed; then
            e_header "Seat back a while... this may take several minutes to install."
            run_vms
            e_success "Done!"
        else
            e_warning "You'll not be able to execute Vagrant or any Virtual Machine until install these guys."
        fi
    fi
    run_vms
    e_success "Done!"
else
    e_warning "Skipped!"
fi